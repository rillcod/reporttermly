<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Progress Report Generator - RillCod Technologies</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --navy-blue: #000080;
            --maroon: #800000;
            --light-maroon: #ffebee;
            --light-navy: #e8eaf6;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }
        .page {
            width: 210mm;
            height: 297mm;
            margin: 0 auto;
            background: white;
            padding: 10mm 15mm 5mm 15mm;
            position: relative;
            box-sizing: border-box;
            overflow: hidden;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 3mm;
            padding-bottom: 2mm;
            border-bottom: 1.5px solid var(--maroon);
        }
        .header-content {
            text-align: center;
        }
        .logo {
            height: 20mm;
            width: auto;
            margin-bottom: 1mm;
        }
        .company-name {
            font-size: 16pt;
            font-weight: bold;
            color: var(--navy-blue);
            margin: 0;
            line-height: 1.2;
        }
        .tagline {
            font-style: italic;
            color: var(--maroon);
            margin: 1mm 0 0;
            font-size: 9pt;
        }
        .contact-info {
            font-size: 7pt;
            color: var(--navy-blue);
            margin-top: 1mm;
        }
        .report-title {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            margin: 2mm 0 3mm;
            color: var(--maroon);
        }
        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2mm;
            margin-bottom: 3mm;
            background-color: var(--light-navy);
            padding: 2mm;
            border-radius: 2mm;
            font-size: 9pt;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3mm;
            margin-top: 2mm;
        }
        .section {
            margin-bottom: 3mm;
        }
        .section-title {
            font-size: 11pt;
            font-weight: bold;
            color: var(--navy-blue);
            margin: 0 0 2mm;
            padding-bottom: 1mm;
            border-bottom: 1px solid var(--maroon);
        }
        .progress-list {
            list-style-type: none;
            padding-left: 0;
            margin: 1mm 0;
            font-size: 9pt;
        }
        .progress-list li {
            margin-bottom: 1mm;
            position: relative;
            padding-left: 3mm;
        }
        .progress-list li:before {
            content: "‚Ä¢";
            color: var(--maroon);
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        .assessment-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1mm 0;
            font-size: 9pt;
        }
        .assessment-table th, .assessment-table td {
            border: 1px solid #ddd;
            padding: 1mm;
            text-align: left;
        }
        .assessment-table th {
            background-color: var(--navy-blue);
            color: white;
            font-size: 9pt;
        }
        .comments {
            background-color: var(--light-maroon);
            padding: 2mm;
            border-radius: 2mm;
            font-size: 9pt;
            margin: 1mm 0;
        }
        .chart-container {
            height: 60mm;
            margin: 2mm 0;
            position: relative;
        }
        .certificate {
            text-align: center;
            margin-top: 3mm;
            padding: 2mm;
            border: 1px solid var(--maroon);
            border-radius: 2mm;
            font-size: 9pt;
        }
        .signature {
            display: flex;
            justify-content: space-between;
            margin-top: 5mm;
        }
        .signature-line {
            border-top: 1px solid var(--navy-blue);
            width: 50mm;
            margin-top: 10mm;
        }
        .form-container {
            background-color: white;
            padding: 5mm;
            border-radius: 2mm;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin: 5mm auto;
            max-width: 200mm;
        }
        .form-group {
            margin-bottom: 3mm;
        }
        label {
            display: block;
            margin-bottom: 1mm;
            font-weight: bold;
            color: var(--navy-blue);
            font-size: 10pt;
        }
        input, select, textarea {
            width: 100%;
            padding: 2mm;
            border: 1px solid #ddd;
            border-radius: 1mm;
            box-sizing: border-box;
            font-size: 10pt;
        }
        textarea {
            min-height: 50px;
            resize: vertical;
        }
        .submit-btn {
            background-color: var(--maroon);
            color: white;
            border: none;
            padding: 3mm 5mm;
            border-radius: 1mm;
            cursor: pointer;
            font-size: 10pt;
            width: 100%;
            margin-top: 3mm;
        }
        footer {
            text-align: center;
            font-size: 7pt;
            color: var(--navy-blue);
            margin-top: 3mm;
            position: absolute;
            bottom: 2mm;
            left: 0;
            right: 0;
            padding: 0 15mm;
        }
        strong {
            color: var(--navy-blue);
        }
        .total-performance {
            background-color: var(--light-navy);
            padding: 2mm;
            border-radius: 2mm;
            margin-top: 2mm;
            font-size: 9pt;
        }
        .performance-grade {
            font-size: 12pt;
            font-weight: bold;
            color: var(--maroon);
            text-align: center;
            margin-top: 1mm;
        }
        .payment-info {
            margin-top: 2mm;
            font-size: 9pt;
            text-align: center;
            font-weight: bold;
        }
        .form-section-title {
            font-size: 12pt;
            font-weight: bold;
            color: var(--navy-blue);
            margin: 5mm 0 2mm;
            padding-bottom: 1mm;
            border-bottom: 1px solid var(--maroon);
        }
        .form-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5mm;
        }
        .add-item-btn {
            background-color: var(--navy-blue);
            color: white;
            border: none;
            padding: 2mm 3mm;
            border-radius: 1mm;
            cursor: pointer;
            font-size: 9pt;
            margin-top: 2mm;
        }
        .progress-item {
            display: flex;
            gap: 2mm;
            margin-bottom: 2mm;
        }
        .progress-item input {
            flex-grow: 1;
        }
        .remove-item-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 1mm;
            cursor: pointer;
            width: 30px;
        }
        .hidden {
            display: none;
        }
        .suggest-btn {
            background-color: var(--navy-blue);
            color: white;
            border: none;
            padding: 2mm 3mm;
            border-radius: 1mm;
            cursor: pointer;
            font-size: 9pt;
            margin-top: 2mm;
        }
        .pregen-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2mm;
            margin-top: 2mm;
        }
        .pregen-option {
            background-color: #f0f0f0;
            padding: 2mm;
            border-radius: 1mm;
            cursor: pointer;
            font-size: 9pt;
            border: 1px solid #ddd;
        }
        .pregen-option:hover {
            background-color: #e0e0e0;
        }
        .ai-generate-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 2mm 3mm;
            border-radius: 1mm;
            cursor: pointer;
            font-size: 9pt;
            margin-top: 2mm;
        }
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 5px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <form id="scoreForm">
            <div class="form-section-title">Student Information</div>
            <div class="form-columns">
                <div class="form-group">
                    <label for="studentName">Student Full Name:</label>
                    <input type="text" id="studentName" name="studentName" required>
                </div>
                <div class="form-group">
                    <label for="courseName">Course Name:</label>
                    <input type="text" id="courseName" name="courseName" value="Python Programming Fundamentals" required>
                </div>
            </div>
            
            <div class="form-columns">
                <div class="form-group">
                    <label for="currentModule">Current Module:</label>
                    <input type="text" id="currentModule" name="currentModule" value="Variables to Conditionals" required>
                </div>
                <div class="form-group">
                    <label for="reportDate">Report Date:</label>
                    <input type="date" id="reportDate" name="reportDate" required>
                </div>
            </div>
            
            <div class="form-columns">
                <div class="form-group">
                    <label for="instructorName">Instructor Name:</label>
                    <input type="text" id="instructorName" name="instructorName" value="RillCod Technologies" required>
                </div>
                <div class="form-group">
                    <label for="duration">Duration:</label>
                    <input type="text" id="duration" name="duration" value="Termly" required>
                </div>
            </div>
            
            <div class="form-section-title">Performance Assessment</div>
            <div class="form-columns">
                <div class="form-group">
                    <label for="theoryScore">Theory Test Score (0-100):</label>
                    <input type="number" id="theoryScore" name="theoryScore" min="0" max="100" required>
                </div>
                <div class="form-group">
                    <label for="practicalScore">Practical Test Score (0-100):</label>
                    <input type="number" id="practicalScore" name="practicalScore" min="0" max="100" required>
                </div>
            </div>
            
            <div class="form-columns">
                <div class="form-group">
                    <label for="attendance">Attendance Percentage (0-100):</label>
                    <input type="number" id="attendance" name="attendance" min="0" max="100" value="100" required>
                </div>
                <div class="form-group">
                    <label for="participation">Class Participation:</label>
                    <select id="participation" name="participation" required>
                        <option value="">Select an option</option>
                        <option value="Excellent">Excellent</option>
                        <option value="Very Good">Very Good</option>
                        <option value="Good">Good</option>
                        <option value="Fair">Fair</option>
                        <option value="Needs Improvement">Needs Improvement</option>
                    </select>
                </div>
            </div>
            
            <div class="form-section-title">Course Progress</div>
            <div class="form-group">
                <label for="moduleTopics">Module Topics (comma separated):</label>
                <input type="text" id="moduleTopics" name="moduleTopics" placeholder="e.g., Variables, Data Types, Conditionals">
                <button type="button" class="ai-generate-btn" id="generateProgressBtn">Generate Progress Items</button>
            </div>
            
            <div id="progressItems">
                <div class="progress-item">
                    <input type="text" name="progressItem[]" placeholder="Progress item (e.g., Variables & Data Types)" required>
                    <button type="button" class="remove-item-btn" onclick="removeProgressItem(this)">√ó</button>
                </div>
            </div>
            <button type="button" class="add-item-btn" onclick="addProgressItem()">Add Progress Item</button>
            
            <div class="form-group">
                <label for="nextModule">Next Module:</label>
                <input type="text" id="nextModule" name="nextModule" value="Loops (while/for) and Functions" required>
            </div>
            
            <div class="form-section-title">Evaluation</div>
            <div class="form-group">
                <label for="strengths">Key Strengths:</label>
                <textarea id="strengths" name="strengths" required></textarea>
                <button type="button" class="suggest-btn" onclick="showStrengthOptions()">Suggest Strengths</button>
                <div id="strengthOptions" class="hidden pregen-options">
                    <div class="pregen-option" onclick="selectStrength('Excellent problem-solving skills')">Excellent problem-solving skills</div>
                    <div class="pregen-option" onclick="selectStrength('Quick grasp of programming concepts')">Quick grasp of concepts</div>
                    <div class="pregen-option" onclick="selectStrength('Strong logical thinking abilities')">Strong logical thinking</div>
                    <div class="pregen-option" onclick="selectStrength('Excellent attention to detail')">Attention to detail</div>
                    <div class="pregen-option" onclick="selectStrength('Creative approach to coding challenges')">Creative approach</div>
                    <div class="pregen-option" onclick="selectStrength('Good collaborative skills')">Collaborative skills</div>
                    <div class="pregen-option" onclick="selectStrength('Persistent in debugging code')">Persistent debugging</div>
                    <div class="pregen-option" onclick="selectStrength('Excellent code organization')">Code organization</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="growth">Areas for Growth:</label>
                <textarea id="growth" name="growth" required></textarea>
                <button type="button" class="suggest-btn" onclick="showGrowthOptions()">Suggest Areas for Growth</button>
                <div id="growthOptions" class="hidden pregen-options">
                    <div class="pregen-option" onclick="selectGrowth('Could benefit from more practice with syntax')">Syntax practice</div>
                    <div class="pregen-option" onclick="selectGrowth('Needs to work on code commenting')">Code commenting</div>
                    <div class="pregen-option" onclick="selectGrowth('Should focus on variable naming conventions')">Variable naming</div>
                    <div class="pregen-option" onclick="selectGrowth('Would benefit from more pseudocode planning')">Pseudocode planning</div>
                    <div class="pregen-option" onclick="selectGrowth('Needs to improve error handling')">Error handling</div>
                    <div class="pregen-option" onclick="selectGrowth('Could work on program efficiency')">Program efficiency</div>
                    <div class="pregen-option" onclick="selectGrowth('Should practice more independent problem-solving')">Independent problem-solving</div>
                    <div class="pregen-option" onclick="selectGrowth('Needs to work on time management')">Time management</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="comments">Overall Comments:</label>
                <textarea id="comments" name="comments" required></textarea>
                <button type="button" class="suggest-btn" onclick="showCommentOptions()">Suggest Comments</button>
                <div id="commentOptions" class="hidden pregen-options">
                    <div class="pregen-option" onclick="selectComment('[Student] has shown remarkable progress in understanding Python fundamentals. With continued practice, [they] will master more advanced concepts quickly.')">Remarkable progress</div>
                    <div class="pregen-option" onclick="selectComment('[Student] demonstrates good understanding of core concepts. Focusing on [their] areas for growth will help [them] become a more well-rounded programmer.')">Good understanding</div>
                    <div class="pregen-option" onclick="selectComment('[Student] is developing solid programming skills. I encourage [them] to practice daily to reinforce the concepts we\'ve covered.')">Developing skills</div>
                    <div class="pregen-option" onclick="selectComment('[Student] shows potential in programming. With more attention to detail and regular practice, [they] will see significant improvement.')">Shows potential</div>
                    <div class="pregen-option" onclick="selectComment('[Student] has made steady progress this term. I recommend targeted practice in [their] weaker areas to build confidence.')">Steady progress</div>
                    <div class="pregen-option" onclick="selectComment('[Student] is beginning to apply concepts effectively. Continued exposure to different problem types will help [them] grow.')">Applying concepts</div>
                    <div class="pregen-option" onclick="selectComment('[Student] participates well in class. Focusing on [their] areas for improvement will help [them] excel in upcoming modules.')">Participates well</div>
                    <div class="pregen-option" onclick="selectComment('[Student] has a good foundation. I encourage [them] to challenge [themselves] with additional practice problems between sessions.')">Good foundation</div>
                </div>
            </div>
            
            <div class="form-section-title">Certificate Information</div>
            <div class="form-group">
                <label for="certificateText">Certificate Text:</label>
                <textarea id="certificateText" name="certificateText" required>This certifies that [Student Name] has successfully completed the [Course Module] module covering [Module Topics] at Rillcod Technologies.</textarea>
            </div>
            
            <div class="form-columns">
                <div class="form-group">
                    <label for="nextTermFee">Next Term Fee:</label>
                    <input type="text" id="nextTermFee" name="nextTermFee" value="‚Ç¶15,000" required>
                </div>
                <div class="form-group">
                    <label for="bankDetails">Bank Details:</label>
                    <input type="text" id="bankDetails" name="bankDetails" value="PROVIDUS | ACCOUNT NUMBER: 7901178957" required>
                </div>
            </div>
            
            <button type="submit" class="submit-btn">Generate PDF Report</button>
        </form>
    </div>
    
    <div id="reportContent" class="page hidden">
        <div class="header">
            <div class="header-content">
                <img src="https://res.cloudinary.com/dpigtwit0/image/upload/c_thumb,w_200,g_face/v1744353437/Logo_03_PNG_y3jntf.png" alt="RillCod Logo" class="logo">
                <div class="company-name">RILLCOD TECHNOLOGIES</div>
                <div class="tagline">Coding Today, Innovating Tomorrow</div>
                <div class="contact-info">
                    üìç 26 Ogiesoba Avenue, Off Airport Road, GRA, Benin City ‚Ä¢ üìû 08116600091 ‚Ä¢ ‚úâ rillcod@gmail.com ‚Ä¢ üåê www.rillcod.com
                </div>
            </div>
        </div>

        <div class="report-title">STUDENT PROGRESS REPORT</div>
        
        <div class="student-info">
            <div><strong>Student Name:</strong> <span id="reportStudentName">[Full Name]</span></div>
            <div><strong>Course:</strong> <span id="reportCourseName">[Course Name]</span></div>
            <div><strong>Current Module:</strong> <span id="reportCurrentModule">[Current Module]</span></div>
            <div><strong>Report Date:</strong> <span id="reportDateDisplay">[Date]</span></div>
            <div><strong>Instructor:</strong> <span id="reportInstructor">[Instructor]</span></div>
            <div><strong>Duration:</strong> <span id="reportDuration">[Duration]</span></div>
        </div>

        <div class="grid-container">
            <div>
                <div class="section">
                    <div class="section-title">COURSE PROGRESS</div>
                    <ul class="progress-list" id="reportProgressItems">
                        <!-- Progress items will be added here -->
                    </ul>
                    <div style="font-style: italic; margin-top: 1mm;"><strong>Next Module:</strong> <span id="reportNextModule">[Next Module]</span></div>
                </div>

                <div class="section">
                    <div class="section-title">PERFORMANCE ASSESSMENT</div>
                    <table class="assessment-table">
                        <tr>
                            <th>Assessment</th>
                            <th>Score</th>
                            <th>Grade</th>
                        </tr>
                        <tr>
                            <td>Theory Test</td>
                            <td id="theoryScoreDisplay">[XX]</td>
                            <td id="theoryGradeDisplay">[A-F]</td>
                        </tr>
                        <tr>
                            <td>Practical Test</td>
                            <td id="practicalScoreDisplay">[XX]</td>
                            <td id="practicalGradeDisplay">[A-F]</td>
                        </tr>
                        <tr>
                            <td>Attendance</td>
                            <td id="attendanceDisplay">[XX]%</td>
                            <td id="attendanceGradeDisplay">[A-F]</td>
                        </tr>
                        <tr>
                            <td>Participation</td>
                            <td id="participationDisplay" colspan="2">[Rating]</td>
                        </tr>
                    </table>
                    
                    <div class="total-performance">
                        <div><strong>Overall Performance:</strong></div>
                        <div class="performance-grade" id="overallGradeDisplay">[A-F]</div>
                    </div>
                </div>
            </div>

            <div>
                <div class="section">
                    <div class="section-title">PERFORMANCE CHART</div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">INSTRUCTOR'S EVALUATION</div>
                    <div class="comments" id="instructorComments">
                        [Student] has shown [progress] in understanding Python fundamentals...
                    </div>
                    <div style="margin-top: 2mm;">
                        <div><strong>‚úÖ Key Strengths:</strong></div>
                        <div id="strengthsDisplay" style="margin-left: 2mm;">[Student strengths]</div>
                    </div>
                    <div style="margin-top: 2mm;">
                        <div><strong>üìà Areas for Growth:</strong></div>
                        <div id="growthDisplay" style="margin-left: 2mm;">[Improvement areas]</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title" style="text-align: center;">CERTIFICATE OF COMPLETION</div>
            <div class="certificate">
                <p id="certificateTextDisplay">[Certificate text]</p>
                <div class="payment-info">
                    NEXT TERM FEE PAYMENT IS <span id="nextTermFeeDisplay">[Fee]</span> TO RILLCOD LTD.<br>
                    BANK: <span id="bankDetailsDisplay">[Bank details]</span>
                </div>
                <div class="signature">
                    <div>
                        <div class="signature-line"></div>
                        <p>Instructor's Signature</p>
                    </div>
                    <div>
                        <div class="signature-line"></div>
                        <p>Date</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            ¬© <span id="currentYear"></span> Rillcod Technologies | All Rights Reserved | Report generated on <span id="footerDate"></span>
        </footer>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Initialize chart variable
        let performanceChart;
        const ctx = document.getElementById('performanceChart').getContext('2d');
        
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // Set default date to today
        document.getElementById('reportDate').valueAsDate = new Date();
        
        // Enhanced course content generator with detailed descriptions
        const courseContentGenerator = {
            getDescription: function(topic) {
                const descriptions = {
                    "variables": "Understanding variable declaration, assignment, naming conventions, and scope",
                    "data types": "Working with integers, floats, strings, booleans, and type conversion",
                    "operators": "Using arithmetic, comparison, logical, and assignment operators",
                    "conditionals": "Implementing if/elif/else statements and logical conditions",
                    "loops": "Using while and for loops with proper control flow and iteration",
                    "functions": "Creating functions with parameters, return values, and understanding scope",
                    "lists": "Working with list creation, indexing, slicing, and common methods",
                    "dictionaries": "Understanding key-value pairs and common dictionary operations",
                    "tuples": "Working with immutable sequences and tuple operations",
                    "sets": "Understanding unique element collections and set operations",
                    "file handling": "Reading from and writing to files with proper file modes",
                    "oop": "Basic understanding of classes, objects, inheritance, and polymorphism",
                    "modules": "Importing and using standard library and custom modules",
                    "exceptions": "Handling errors and exceptions with try/except blocks",
                    "debugging": "Identifying and fixing syntax errors and logical bugs",
                    "comments": "Writing effective code comments and documentation",
                    "strings": "String manipulation methods and formatting techniques",
                    "input/output": "Using input() and print() functions effectively",
                    "type conversion": "Converting between different data types explicitly",
                    "algorithm": "Understanding basic algorithm design and implementation"
                };
    
                // Find the best matching topic (case insensitive, partial matches)
                const lowerTopic = topic.toLowerCase();
                for (const [key, desc] of Object.entries(descriptions)) {
                    if (lowerTopic.includes(key) || key.includes(lowerTopic)) {
                        return `${topic.charAt(0).toUpperCase() + topic.slice(1)}: ${desc}`;
                    }
                }
                
                // Default description if no match found
                return `${topic}: Demonstrated understanding of ${topic.toLowerCase()} concepts`;
            },
            
            generateFromTopics: function(topics) {
                return topics.map(topic => {
                    const trimmedTopic = topic.trim();
                    if (!trimmedTopic) return null;
                    return this.getDescription(trimmedTopic);
                }).filter(item => item !== null);
            }
        };
    
        // Add progress item
        function addProgressItem() {
            const container = document.getElementById('progressItems');
            const newItem = document.createElement('div');
            newItem.className = 'progress-item';
            newItem.innerHTML = `
                <input type="text" name="progressItem[]" placeholder="Progress item (e.g., Variables & Data Types)" required>
                <button type="button" class="remove-item-btn" onclick="removeProgressItem(this)">√ó</button>
            `;
            container.appendChild(newItem);
        }
        
        // Remove progress item
        function removeProgressItem(button) {
            const items = document.querySelectorAll('#progressItems .progress-item');
            if (items.length > 1) {
                button.parentElement.remove();
            } else {
                alert("You need at least one progress item.");
            }
        }
        
        // Show strength options
        function showStrengthOptions() {
            document.getElementById('strengthOptions').classList.toggle('hidden');
            document.getElementById('growthOptions').classList.add('hidden');
            document.getElementById('commentOptions').classList.add('hidden');
        }
        
        // Select strength
        function selectStrength(strength) {
            document.getElementById('strengths').value = strength;
            document.getElementById('strengthOptions').classList.add('hidden');
        }
        
        // Show growth options
        function showGrowthOptions() {
            document.getElementById('growthOptions').classList.toggle('hidden');
            document.getElementById('strengthOptions').classList.add('hidden');
            document.getElementById('commentOptions').classList.add('hidden');
        }
        
        // Select growth area
        function selectGrowth(growth) {
            document.getElementById('growth').value = growth;
            document.getElementById('growthOptions').classList.add('hidden');
        }
        
        // Show comment options
        function showCommentOptions() {
            document.getElementById('commentOptions').classList.toggle('hidden');
            document.getElementById('strengthOptions').classList.add('hidden');
            document.getElementById('growthOptions').classList.add('hidden');
        }
        
        // Select comment
        function selectComment(comment) {
            document.getElementById('comments').value = comment;
            document.getElementById('commentOptions').classList.add('hidden');
        }
        
        // Generate progress items from topics
        document.getElementById('generateProgressBtn').addEventListener('click', function() {
            const topicsInput = document.getElementById('moduleTopics').value;
            if (!topicsInput.trim()) {
                alert("Please enter some topics first");
                return;
            }
            
            const btn = this;
            const originalText = btn.textContent;
            btn.innerHTML = 'Generating... <span class="loading"></span>';
            btn.disabled = true;
            
            // Split topics by comma and clean them up
            const topics = topicsInput.split(',')
                .map(topic => topic.trim())
                .filter(topic => topic.length > 0);
            
            // Generate progress items
            const generatedItems = courseContentGenerator.generateFromTopics(topics);
            
            // Update the UI with generated items
            const progressItemsContainer = document.getElementById('progressItems');
            
            // Clear existing items except the first one
            while (progressItemsContainer.children.length > 1) {
                progressItemsContainer.removeChild(progressItemsContainer.lastChild);
            }
            
            // Update first item
            const firstInput = progressItemsContainer.querySelector('input');
            firstInput.value = generatedItems[0] || "Enter progress item";
            
            // Add remaining items
            for (let i = 1; i < generatedItems.length; i++) {
                const newItem = document.createElement('div');
                newItem.className = 'progress-item';
                newItem.innerHTML = `
                    <input type="text" name="progressItem[]" value="${generatedItems[i]}" required>
                    <button type="button" class="remove-item-btn" onclick="removeProgressItem(this)">√ó</button>
                `;
                progressItemsContainer.appendChild(newItem);
            }
            
            // If no items were generated (shouldn't happen), ensure at least one exists
            if (generatedItems.length === 0) {
                const firstInput = progressItemsContainer.querySelector('input');
                firstInput.value = "Enter progress item";
            }
            
            btn.textContent = originalText;
            btn.disabled = false;
        });
        
        // Handle form submission
        document.getElementById('scoreForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            // Get all progress items
            data.progressItems = Array.from(document.querySelectorAll('[name="progressItem[]"]')).map(input => input.value);
            
            // Format date
            const reportDate = new Date(data.reportDate);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = reportDate.toLocaleDateString('en-US', options);
            
            // Calculate grades
            const theoryScore = parseInt(data.theoryScore);
            const practicalScore = parseInt(data.practicalScore);
            const attendance = parseInt(data.attendance);
            
            const theoryGrade = calculateGrade(theoryScore);
            const practicalGrade = calculateGrade(practicalScore);
            const attendanceGrade = calculateGrade(attendance);
            const overallGrade = calculateGrade((theoryScore + practicalScore + attendance) / 3);
            
            // Replace placeholders in comments and certificate text
            const processedComments = data.comments.replace(/\[Student\]/g, data.studentName)
                                                 .replace(/\[they\]/g, data.studentName)
                                                 .replace(/\[them\]/g, data.studentName)
                                                 .replace(/\[their\]/g, data.studentName + "'s");
            
            const processedCertText = data.certificateText.replace(/\[Student Name\]/g, data.studentName)
                                                         .replace(/\[Course Module\]/g, data.currentModule)
                                                         .replace(/\[Module Topics\]/g, data.currentModule);
            
            // Update the report
            document.getElementById('reportStudentName').textContent = data.studentName;
            document.getElementById('reportCourseName').textContent = data.courseName;
            document.getElementById('reportCurrentModule').textContent = data.currentModule;
            document.getElementById('reportDateDisplay').textContent = formattedDate;
            document.getElementById('footerDate').textContent = formattedDate;
            document.getElementById('reportInstructor').textContent = data.instructorName;
            document.getElementById('reportDuration').textContent = data.duration;
            
            // Update progress items
            const progressList = document.getElementById('reportProgressItems');
            progressList.innerHTML = '';
            data.progressItems.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${item.split(':')[0]}:</strong> ${item.split(':')[1] || ''}`;
                progressList.appendChild(li);
            });
            
            document.getElementById('reportNextModule').textContent = data.nextModule;
            
            // Update assessment
            document.getElementById('theoryScoreDisplay').textContent = theoryScore;
            document.getElementById('theoryGradeDisplay').textContent = theoryGrade;
            document.getElementById('practicalScoreDisplay').textContent = practicalScore;
            document.getElementById('practicalGradeDisplay').textContent = practicalGrade;
            document.getElementById('attendanceDisplay').textContent = attendance + '%';
            document.getElementById('attendanceGradeDisplay').textContent = attendanceGrade;
            document.getElementById('overallGradeDisplay').textContent = overallGrade;
            document.getElementById('participationDisplay').textContent = data.participation;
            
            // Update evaluation
            document.getElementById('instructorComments').textContent = processedComments;
            document.getElementById('strengthsDisplay').textContent = data.strengths;
            document.getElementById('growthDisplay').textContent = data.growth;
            
            // Update certificate
            document.getElementById('certificateTextDisplay').innerHTML = processedCertText;
            document.getElementById('nextTermFeeDisplay').textContent = data.nextTermFee;
            document.getElementById('bankDetailsDisplay').textContent = data.bankDetails;
            
            // Update or create chart
            updateChart(theoryScore, practicalScore, attendance);
            
            // Show the report and generate PDF after a short delay to allow chart to render
            document.getElementById('reportContent').classList.remove('hidden');
            setTimeout(() => {
                generatePDF();
                document.getElementById('reportContent').classList.add('hidden');
            }, 1000);
        });
        
        function calculateGrade(score) {
            if (score >= 90) return 'A';
            if (score >= 80) return 'B';
            if (score >= 70) return 'C';
            if (score >= 60) return 'D';
            return 'F';
        }
        
        function updateChart(theoryScore, practicalScore, attendance) {
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Theory Test', 'Practical Test', 'Attendance'],
                    datasets: [{
                        label: 'Score (%)',
                        data: [theoryScore, practicalScore, attendance],
                        backgroundColor: [
                            'rgba(0, 0, 128, 0.7)',
                            'rgba(128, 0, 0, 0.7)',
                            'rgba(0, 128, 0, 0.7)'
                        ],
                        borderColor: [
                            'rgba(0, 0, 128, 1)',
                            'rgba(128, 0, 0, 1)',
                            'rgba(0, 128, 0, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage Score'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Performance Metrics',
                            font: {
                                size: 14
                            }
                        }
                    }
                }
            });
        }
        
        function generatePDF() {
            const reportElement = document.getElementById('reportContent');
            
            // Use html2canvas with improved options for better PDF rendering
            html2canvas(reportElement, {
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true,
                windowWidth: reportElement.scrollWidth,
                windowHeight: reportElement.scrollHeight,
                scrollX: 0,
                scrollY: 0,
                backgroundColor: '#FFFFFF'
            }).then(canvas => {
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png', 1.0);
                
                // Calculate image dimensions to fit the page
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = pageWidth - 20; // Add margins
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Center the image on the page
                const x = (pageWidth - imgWidth) / 2;
                const y = 5; // Reduced top margin
                
                pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
                
                // Save the PDF
                const studentName = document.getElementById('studentName').value.replace(/\s+/g, '_');
                pdf.save(`RillCod_Progress_Report_${studentName}.pdf`);
            });
        }
    </script>
</body>
</html>
